/**
 * @package    boxfish.js
 * @author     Jeremy Harris <http://www.jeremyharris.me>
 * @version    0.2.0
 * @since      2014-08-20
 */
!function(a){a.fn.boxfish=function(b){function c(){d()}function d(){r=j(),s=k(),e(),f()}function e(){var b=l(),c=p.first();t=parseInt(c.css("margin-left"),10)+parseInt(c.css("margin-right"),10),u=parseInt(c.css("padding-left"),10)+parseInt(c.css("padding-right"),10),horizontalBorders=parseInt(c.css("border-left-width"),10)+parseInt(c.css("border-right-width"),10),p.each(function(){a(this).width(b-(t+u+horizontalBorders))})}function f(){var b=m();p.each(function(){a(this).css("height","auto"),a(this).animate({height:b},1,function(){g()})})}function g(){var b=[];for(x=0;x<p.length;x++)topPos=p[x].offsetTop,b[topPos]||(b[topPos]=[]),b[topPos].push(p[x]);for(var c in b){for(maxRowHeight=[],x=0;x<b[c].length;x++){var d=a(b[c][x]).outerHeight(!0);maxRowHeight[c]||(maxRowHeight[c]=0),maxRowHeight[c]<d&&(maxRowHeight[c]=d)}for(x=0;x<b[c].length;x++)a(b[c][x]).animate({height:maxRowHeight[c]},1)}}function h(){var a=p.find("img");return a.each(function(a,b){return b.complete?"undefined"!=typeof b.naturalWidth&&0===b.naturalWidth?!1:void 0:!1}),!0}function j(){return parseInt(q.width(),10)}function k(){return parseInt(q.height(),10)}function l(){var a=[0,0],b=o.columns;for(i=0;i<o.breakpoints.length;i++)o.breakpoints[i][0]<r&&o.breakpoints[i][0]>a[0]&&(a=o.breakpoints[i]);return a[1]>0&&(b=a[1]),r/b}function m(){var b=0,c=0;return p.each(function(){c=a(this).outerHeight(!0),c>b&&(b=c)}),b}var n,o=a.extend({columns:3,breakpoints:[[1280,5],[1024,4],[768,3],[480,2],[300,1]]},b),p=a(this),q=(p.length,p.parent()),r=j(),s=k(),t=0,u=0;p.addClass("boxfish-box"),q.addClass("boxfish-container"),d(),a(window).on("resize",function(){clearTimeout(n),n=setTimeout(c,100)});var v=function(){setTimeout(function(){h()?f():v()},100)};return v(),this.addBreakpoint=function(a,b){a=parseInt(a,10),b=parseInt(b,10);var c=!1;for(i=0;i<o.breakpoints.length;i++)if(o.breakpoints[i][0]==a){o.breakpoints[i][1]=b,c=!0;break}return c||(o.breakpoints[o.breakpoints.length]=[a,b]),e(),this},this}}(jQuery);